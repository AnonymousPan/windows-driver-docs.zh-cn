---
title: Wi-Fi 热点卸载体系结构
description: Wi-Fi 热点卸载体系结构
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 18f00971bef56d0c0f886e017b2b4c33a47f59ad
ms.sourcegitcommit: 7ca2d3e360a4ae1d4d3c3092bd34492a2645ef74
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/02/2020
ms.locfileid: "89403464"
---
# <a name="wi-fi-hotspot-offloading-architecture"></a>Wi-Fi 热点卸载体系结构

[!include[Wi-Fi Hotspot Offloading deprecation](../includes/wi-fi-hotspot-offloading-deprecation.md)]

下图显示 Wi-fi 卸载框架中的主要组件。

![Wi-fi 热点卸载框架](images/WiFi_Hotspot_Offload-1.png "Wi-fi 热点卸载框架")

## <a name="hotspot-offload-service"></a>热点卸载服务

热点卸载服务执行以下功能：

* 标识属于热点网络的 Wi-fi 网络
* 监视与热点网络的连接的创建和维护
* 监视和响应适用于热点网络的连接状态更改
* 监视并响应用户设置中的更改，以启用或禁用 Wi-fi 热点卸载

热点卸载服务依赖于移动运营商和/或 Oem 创建的热点插件来识别和验证其热点网络。

## <a name="hotspot-plugin-host"></a>热点插件主机

作用点插件主机是热点卸载服务和合作伙伴实现的热点插件之间的接口。 例如，对于从网络列表标识热点网络的热点插件的查询，通过热点插件主机进行。 此插件主机还允许热点插件通过 WinHTTP/WinInet API 发送和接收 HTTP 消息，并向用户发送短信警报和通知。

作用点卸载服务负责为每个热点插件创建一个热点插件主机。

## <a name="hotspot-plugin"></a>热点插件

作用点插件执行以下功能：

* 使用可用网络列表标识热点网络
* 使用由 OEM 或移动运营商指定的 EAP SIM/亦即，基于 HTTP 的身份验证启用到网络的自动连接
* 通过 WinHTTP/WinInet API 发送/接收 HTTP 消息
* 将 SMS 通知发送给用户
* 选择用于 HTTP 请求的持有者令牌，以通过蜂窝网络发送和接收消息

它还直接与以下外部组件交互：

* WinInet/WinHTTP

移动运营商和/或 Oem 必须实现并安装自己的热点插件，才能启用 Wi-fi 卸载。 插件的安装包包括以下各项：

* 插件 DLL
* 包含特定于连接的信息的文件，如 Ssid 列表、加密的凭据等。
  * **注意：** 这些文件是可选的，在大多数插件中都不需要。
* 注册表配置

## <a name="hotspot-user-interface"></a>热点用户界面

"热点" 用户界面显示在 "Wi-fi 控制面板" 中。 通过用户界面，用户可以：

* 启用/禁用自动 Wi-fi 热点卸载。
* 在自动连接到热点网络期间查看连接状态。
* 手动连接到热点网络。
  * 如果在设备上启用了热点卸载功能，则用户启动的与热点卸载服务标识为热点网络的网络的连接将被视为自动连接到 Wi-fi 热点网络。 否则，手动连接将作为标准 Wi-fi 连接进行处理。
* 如果用户禁用了移动运营商热点连接，则配置用于连接到热点网络的普通 Wi-fi 配置文件。

仅在配置了至少一个插件时才会显示热点用户界面。

## <a name="example-automatic-connection-to-a-hotspot-network"></a>示例：自动连接到热点网络

下面是在自动连接到热点网络期间发生的一系列组件交互的简要说明：

1. Wi-fi 连接服务将未连接的网络列表发送到热点卸载服务。
2. 对于网络列表中的每个条目，热点卸载服务会按插件排名)  (查询热点插件，以确定它是否是热点网络。 用于标识网络的第一个插件要求在连接时对该网络进行身份验证。
3. 当热点插件将网络标识为热点网络时，它将返回与该网络关联的优先级值，要使用的身份验证方法 (是基于 HTTP 还是基于 EAP SIM，或者不需要任何特定的 SIM) 和（可选）网络显示掩码。 优先级值指示连接应尝试的顺序。 在连接到具有较高优先级值的网络之前，将尝试连接到具有较低优先级值的网络。
4. 热点卸载服务为所选网络创建连接管理器配置文件。
5. 作用点卸载服务配置文件还可以配置一个初始策略设置，该设置会导致连接管理器阻止应用程序连接到网络，直到获得授权。
6. 热点卸载服务将所选网络标记为热点网络。
7. 热点卸载服务通过热点插件主机调用热点插件，以便在需要时进行任何连接前处理。
8. 当热点插件完成了连接前处理后，热点卸载服务会等待连接管理器连接到热点网络，并提供连接完成或失败通知。
9. 完成连接时，热点卸载服务会将请求发送到热点插件，以执行任何必要的连接后操作，如 HTTPS 交换。
10. 同时，热点卸载服务执行以下操作：
    * 启动计时器，以完成连接后活动 (当前设置为5分钟后激发) 
    * 设置适当的用户界面显示状态
11. 如果作用点插件指示连接成功，则热点卸载服务将调用连接管理器以取消阻止连接并通知应用程序。
12. 如果连接后请求超时：
    * 热点卸载服务重置热点插件的状态。
    * 如果重试不会耗尽，则热点卸载服务将启动尝试重新连接，否则会删除网络的热点配置文件。
13. 如果热点插件指示故障并重试，则热点卸载服务将启动尝试重新连接，否则会删除网络的热点配置文件。

