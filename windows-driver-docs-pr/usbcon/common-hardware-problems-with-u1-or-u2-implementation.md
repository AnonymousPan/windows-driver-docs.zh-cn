---
description: 本主题讨论了用于省电的 LPM 机制，并介绍了当前 USB 3.0 硬件中出现的各种常见问题。
title: U1 或 U2 实现的常见硬件问题
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: b07f3bcf2fab719925e14c8fde7718587d81aa6a
ms.sourcegitcommit: 15caaf6d943135efcaf9975927ff3933957acd5d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/27/2020
ms.locfileid: "88968868"
---
# <a name="common-hardware-problems-with-u1-or-u2-implementation"></a>U1 或 U2 实现的常见硬件问题


本主题讨论了用于省电的 LPM 机制，并介绍了当前 USB 3.0 硬件中出现的各种常见问题。 USB-如果证书要求设备、集线器和控制器正确实现 U1 和 U2。 该认证旨在通过符合性测试强制实施该要求。 Windows 8) 附带的 Microsoft USB 驱动程序堆栈 (充分利用 U1 和 U2 机制来实现最大节能。 因此，此主题中所述的问题会更频繁地出现。 这些问题可能会导致用户体验不佳，并可能阻止 Windows 实现 USB 3.0 规范提供的节能。

硬件供应商必须采取措施来避免本主题中所述的问题。 对于当前发布的硬件有问题，供应商应该尽快发布更新的固件并尽快修复，并且必须与合作伙伴合作以确保向客户提供更新。

LPM 可大大节省电能，并导致电池寿命延长。 因此，软件和硬件应同时支持 LPM 的最大程度。 但是，USB 3.0 硬件的某些早期原型在 LPM 实现中存在一些常见问题，导致最终用户体验变得很差。 本部分的目的是找出这些问题。

## <a name="device-related-issues"></a>与设备相关的问题


-   **不支持 U1 或 U2**

    某些设备从不启动 U1 和 U2 转换，并始终拒绝由主机启动的转换，即使长时间没有传输，并且 LPM 的性能影响不太重要。 这些设备不仅会阻止其链路的节能，还会阻止任何上游链路进入 U1 或 U2。

-   **延迟包实现不正确**

    如 [包延迟](u1-and-u2-transitions.md#packet-deferring)中所述，在设备发送 ERDY 后，设备必须在 U0 中保留链接，直到主机将响应发送到 ERDY 或 **tERDYTimeout** 。 某些设备在获取延迟数据包通知之后无法发送 ERDY。 这可能导致传输永远无法完成的问题。

-   **在 U1 中发送 LPFS 失败**

    当链接位于 U1 时，设备的美国端口应始终发送 **LPFS** 。 某些设备无法执行此操作，这会导致链接伙伴假定设备已被删除。 这可能会导致该链接进入错误状态，并可能会导致设备重新枚举。

-   **设置 \_ SEL 传输失败**

    该软件会发送一组 " \_ SEL 控制" 控制传输，通知设备有关 U1 和 U2 的各种退出延迟。 某些设备将停止传输。 这可能会导致枚举失败或导致软件无法为设备启用 U1 或 U2。

-   **如果 \_ (U1 enable 或 U2 启用了设置功能失败， \_ 则 \_) 传输**

    通过发送设置的功能控制传输，软件可以启用或禁用设备启动 U1 或 U2 转换的功能 \_ 。 某些设备将停止传输。 这可能会导致枚举失败或软件不为设备启用 U1 或 U2。

## <a name="hub-or-controller-related-issues"></a>与集线器或控制器相关的问题


-   **不支持 U1 或 U2 计时器**

    对于 LPM 实现，最常见的问题之一是，计时器过期时启动 U1 或 U2 转换失败。 即使在软件为 DS 端口编程的 U1 或 U2 timeout 值后，某些集线器或控制器也不会启动到 U1 或 U2 在计时器过期时的转换。 此行为可防止通过 LPM 节省电力。

-   **硬编码的 U1 或 U2 超时值**

    某些主机控制器支持 U1 和 U2 转换，但具有硬编码的超时值。 在此超时之前，它们不会启动这些转换并拒绝链接伙伴启动的转换。 此行为会导致 U1 和 U2 转换错失机会，因此可能会导致节能。

-   **延迟数据包的实现不正确**

    如 [数据包延迟](u1-and-u2-transitions.md#packet-deferring)中所述，集线器负责将延迟位数据包标头发送回必须处理数据包的主机，类似于设备中的 NRDY 通知。 有些中心无法将延迟数据包发送到主机或设备。 当设备最终发送 ERDY 时，某些主机无法正确处理延迟位数据包或重新发送传输。 这会导致传输失败和不可靠的行为。

-   **未连接任何设备时不将上游端口发送到 U2**

    如果没有连接下游设备，某些中心无法启动美国端口的 U1 或 U2 转换。 有些中心将此链接发送到 U1，但在此方案中不会发送到 U2。 此问题已在此白皮书的发行版中的许多当前的 USB 3.0 硬件交付实现中被发现。 此行为会阻止最佳节能。

-   **不将 US 端口从 U1 转换到 U2**

    当集线器的 DS 端口从 U1 转换到 U2 或更低的状态时，某些中心无法将美国端口从 U1 转换为 U0。 如果中心连接到的 DS 端口的非活动计时器设置为0xFF，则会发生这种情况。 此行为会阻止最佳节能。

-   **从 U1/U2 过渡到 U3**

    如果集线器或控制器的 DS 端口位于 U1 或 U2 中，而软件在端口上启动了一个 U3 转换，则父集线器或控制器负责首先将链接转换为 U0，然后转换为 U3。 有些集线器和控制器不能正确地处理该需求。 这可能会导致该链接进入错误状态，并可能会导致设备重新枚举。  

 

 




